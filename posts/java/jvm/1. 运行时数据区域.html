<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>1. 运行时数据区域 | River 江河</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <script charset="utf-8" async="async" src="/js/jquery.min.js"></script>
    <script charset="utf-8" async="async" src="/js/fingerprint2.min.js"></script>
    <script charset="utf-8" async="async" src="https://s9.cnzz.com/z_stat.php?id=1278232949&amp;web_id=1278232949"></script>
    <script>
            var _hmt = _hmt || [];
            (function() {
                var hm = document.createElement("script");
                hm.src = "https://hm.baidu.com/hm.js?e0d604d5dea105bdeffb878e1b5c2b0f";
                var s = document.getElementsByTagName("script")[0]; 
                s.parentNode.insertBefore(hm, s);
            })();
          </script>
    <meta name="description" content="积少成多，汇聚江河。">
    <meta property="article:modified_time" content="null">
    <meta property="og:title" content="1. 运行时数据区域">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/posts/java/jvm/1.%20%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E5%9F%9F.html">
    <meta name="twitter:title" content="1. 运行时数据区域">
    <meta name="twitter:url" content="/posts/java/jvm/1.%20%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E5%9F%9F.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="robots" content="all">
    <meta name="author" content="米凤君">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="keywords" content="river,米凤君,设计模式,虚拟机">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <link rel="preload" href="/assets/css/0.styles.37e14bdf.css" as="style"><link rel="preload" href="/assets/css/styles.css?v=1635955335105" as="style"><link rel="preload" href="/assets/js/cg-styles.js?v=1635955335105" as="script"><link rel="preload" href="/assets/js/cg-app.js?v=1635955335105" as="script"><link rel="preload" href="/assets/js/cg-4.js?v=1635955335105" as="script"><link rel="preload" href="/assets/js/cg-3.js?v=1635955335105" as="script"><link rel="preload" href="/assets/js/cg-26.js?v=1635955335105" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.37e14bdf.css"><link rel="stylesheet" href="/assets/css/styles.css?v=1635955335105">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/favicon.ico" alt="River 江河" class="logo"> <span class="site-name can-hide">River 江河</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/posts/index/nav.html" class="nav-link">
  导读
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/posts/java/jvm/1. 运行时数据区域.html" class="nav-link">
  JVM
</a></li></ul></div></div><div class="nav-item"><a href="/posts/about/about-me.html" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="https://github.com/mifengjun" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/posts/index/nav.html" class="nav-link">
  导读
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/posts/java/jvm/1. 运行时数据区域.html" class="nav-link">
  JVM
</a></li></ul></div></div><div class="nav-item"><a href="/posts/about/about-me.html" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="https://github.com/mifengjun" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>JVM 目录</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/posts/java/jvm/1. 运行时数据区域.html" class="active sidebar-link">1. 运行时数据区域</a></li><li><a href="/posts/java/jvm/2. 对象的创建与访问.html" class="sidebar-link">2. 对象的创建与访问</a></li><li><a href="/posts/java/jvm/3. 垃圾回收.html" class="sidebar-link">3. 垃圾回收</a></li><li><a href="/posts/java/jvm/4. 垃圾收集算法.html" class="sidebar-link">4. 垃圾收集算法</a></li><li><a href="/posts/java/jvm/5. GC 原理.html" class="sidebar-link">5. GC 原理</a></li><li><a href="/posts/java/jvm/6. 垃圾收集器.html" class="sidebar-link">6. 垃圾收集器</a></li><li><a href="/posts/java/jvm/7. class 文件.html" class="sidebar-link">7. class 文件</a></li><li><a href="/posts/java/jvm/8. 类的生命周期.html" class="sidebar-link">8. 类的生命周期</a></li><li><a href="/posts/java/jvm/9. 虚拟机编译原理.html" class="sidebar-link">9. 虚拟机编译原理</a></li></ul></section></li></ul> </aside> <div><main class="page"> <div class="theme-default-content content__default"><h1 id="自动内存管理"><a href="#自动内存管理" class="header-anchor">#</a> 自动内存管理</h1> <blockquote><p>Java与C++之间有一堵由内存动态分配和垃圾收集技术所围成的高墙，墙外面的人想进去，墙里面的人却想出来。
—— 出自周志明《深入理解 Java 虚拟机》</p></blockquote> <p>Java 的内存区域与内存溢出。</p> <p>对于 Java 程序来讲，内存是由虚拟机的内存自动管理机制<em>垃圾回收</em>来进行管理的。这样便使得程序不容易出现内存溢出和内存泄漏问题。但是一旦出现内存问题，排查和解决起来便不是一件容易的事。</p> <h2 id="运行时数据区域"><a href="#运行时数据区域" class="header-anchor">#</a> 运行时数据区域</h2> <ul><li>程序计数器</li> <li>虚拟机栈</li> <li>本地方法栈</li> <li>堆</li> <li>方法区 - 运行时常量池</li> <li>直接内存</li></ul> <h3 id="pc寄存器-程序计数器"><a href="#pc寄存器-程序计数器" class="header-anchor">#</a> PC寄存器（程序计数器）</h3> <ul><li><strong>线程私有</strong></li> <li>存储<strong>当前方法的字节码位置</strong>，如果是<strong>本地方法则存储 undefined</strong></li> <li>唯一一个不会出现 <strong>OOM</strong> 的位置</li> <li>方法执行时使用；</li></ul> <h3 id="java-虚拟机栈"><a href="#java-虚拟机栈" class="header-anchor">#</a> Java 虚拟机栈</h3> <ul><li><strong>线程私有</strong></li> <li>存储程序方法执行时的 <strong>栈帧</strong></li> <li>达到栈允许最大容量抛出 <strong>StackOverflow Error</strong> 栈溢出</li> <li>允许动态扩展，申请不到内存时抛出 <strong>OOM</strong>。（允许动态扩展由虚拟机实现方自行选择，hotspot选择的则是不允许动态扩展）</li> <li>不需要保证连续的内存</li> <li>方法执行时使用；</li></ul> <p><em>注：在 hotspot 中不允许扩展栈内存，但同样会发生 OOM ，这是发生在创建线程内存申请时内存不足抛出的OOM，这里也属于栈原因引起的。</em></p> <h3 id="本地方法栈"><a href="#本地方法栈" class="header-anchor">#</a> 本地方法栈</h3> <p>同上</p> <p><em>注：说明两者服务对象，虚拟机栈服务于 Java 程序，本地方法栈服务于 JVM 程序（native 方法）。</em></p> <h3 id="堆"><a href="#堆" class="header-anchor">#</a> 堆</h3> <ul><li>线程共享</li> <li>存储类实例、数组对象</li> <li>容量超过允许最大值时抛出 <strong>OOM</strong> 异常（允许动态扩展）</li> <li>不需要保证连续的内存</li> <li>创建对象时使用</li></ul> <h3 id="方法区"><a href="#方法区" class="header-anchor">#</a> 方法区</h3> <ul><li>线程共享</li> <li>存储类的结构信息（方法、字段、构造函数）、运行时常量池</li> <li>容量超过允许最大值时抛出 <strong>OOM</strong> 异常（允许动态扩展）</li> <li>不需要保证连续的内存</li> <li>虚拟机启动时创建</li> <li>后被替换为元空间（这里的内容要和 hotspot 的“永久代“一起理解）</li></ul> <h3 id="运行时常量池"><a href="#运行时常量池" class="header-anchor">#</a> 运行时常量池</h3> <p>（这部分内存区域同在方法区中体现）</p> <ul><li>线程共享</li> <li>存储接口或类的常量池（字面量 与 <strong>符号</strong>引用<code>类的全部限定名等信息</code>）</li> <li>类加载时创建</li> <li>创建过程使用的方法区内存大小，可能出现 <strong>OOM</strong> 异常</li></ul> <h3 id="直接内存"><a href="#直接内存" class="header-anchor">#</a> 直接内存</h3> <p>（这部分为延展内容）</p> <ul><li>不受虚拟机参数控制，直接使用主机内存，受主机内存大小限制；</li> <li>JDK4中的 NIO 首次使用；</li> <li>在设置JVM参数时，需考虑直接内存的使用大小，防止其过渡使用出现 <strong>OOM</strong>；</li> <li>JDK7开始将方法区移到这部分区域（永久代内容），直到 JDK8 全部移入元空间（这里指 hotspot 虚拟机）</li></ul> <table><thead><tr><th>作用\名称</th> <th>PC寄存器（程序计数器）</th> <th>Java虚拟机、本地方法栈</th> <th>Java 堆</th> <th>方法区</th></tr></thead> <tbody><tr><td>异常情况</td> <td>无</td> <td>栈溢出、堆溢出</td> <td>堆溢出</td> <td>堆溢出</td></tr> <tr><td>需要连续内存</td> <td>否</td> <td>否</td> <td>否</td> <td>否</td></tr> <tr><td>存储内容</td> <td>在执行 Java 代码时，存储字节码地址。<br>在执行本地方法时，存储 undefined</td> <td>栈帧（每个栈帧以方法为单位）</td> <td>类实例、数组对象</td> <td>类的结构信息、字段、方法等</td></tr> <tr><td>使用时机</td> <td>方法执行时</td> <td>方法执行时</td> <td>创建对象时</td> <td>类被加载时</td></tr> <tr><td>线程私有</td> <td>是</td> <td>是</td> <td>否</td> <td>否</td></tr></tbody></table> <h1 id="写在最后"><a href="#写在最后" class="header-anchor">#</a> 写在最后</h1> <p>Java 的对象搁哪现在你清楚了吗？每天一点点，啃完虚拟机。欢迎加群一起讨论学习，大家一起学习效率很高哦</p> <hr></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/mifengjun/river/edit/master/docs/posts/java/jvm/1. 运行时数据区域.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">2021/11/3</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/posts/java/jvm/2. 对象的创建与访问.html">
          2. 对象的创建与访问
        </a>
        →
      </span></p></div> </main></div> <aside class="page-sidebar"> <div class="page-side-toolbar"><div class="option-box-toc-fixed"><div class="toc-container-sidebar"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="max-height:650px"><div style="font-weight:bold;text-align:center;">1. 运行时数据区域</div> <hr> <div class="toc-box"><ul class="toc-sidebar-links"><li><a href="/posts/java/jvm/1.%20%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E5%9F%9F.html#运行时数据区域" class="toc-sidebar-link">运行时数据区域</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/posts/java/jvm/1.%20%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E5%9F%9F.html#pc寄存器-程序计数器" class="toc-sidebar-link">PC寄存器（程序计数器）</a></li><li class="toc-sidebar-sub-header"><a href="/posts/java/jvm/1.%20%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E5%9F%9F.html#java-虚拟机栈" class="toc-sidebar-link">Java 虚拟机栈</a></li><li class="toc-sidebar-sub-header"><a href="/posts/java/jvm/1.%20%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E5%9F%9F.html#本地方法栈" class="toc-sidebar-link">本地方法栈</a></li><li class="toc-sidebar-sub-header"><a href="/posts/java/jvm/1.%20%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E5%9F%9F.html#堆" class="toc-sidebar-link">堆</a></li><li class="toc-sidebar-sub-header"><a href="/posts/java/jvm/1.%20%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E5%9F%9F.html#方法区" class="toc-sidebar-link">方法区</a></li><li class="toc-sidebar-sub-header"><a href="/posts/java/jvm/1.%20%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E5%9F%9F.html#运行时常量池" class="toc-sidebar-link">运行时常量池</a></li><li class="toc-sidebar-sub-header"><a href="/posts/java/jvm/1.%20%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E5%9F%9F.html#直接内存" class="toc-sidebar-link">直接内存</a></li></ul></li></ul></div></div></div></div></div> <div class="option-box-toc-over"><img src="/images/system/toc.png" class="nozoom"> <span class="show-txt">目录</span> <div class="toc-container"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="max-height:550px"><div style="font-weight:bold;text-align:center;">1. 运行时数据区域</div> <hr> <div class="toc-box"><ul class="toc-sidebar-links"><li><a href="/posts/java/jvm/1.%20%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E5%9F%9F.html#运行时数据区域" class="toc-sidebar-link">运行时数据区域</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/posts/java/jvm/1.%20%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E5%9F%9F.html#pc寄存器-程序计数器" class="toc-sidebar-link">PC寄存器（程序计数器）</a></li><li class="toc-sidebar-sub-header"><a href="/posts/java/jvm/1.%20%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E5%9F%9F.html#java-虚拟机栈" class="toc-sidebar-link">Java 虚拟机栈</a></li><li class="toc-sidebar-sub-header"><a href="/posts/java/jvm/1.%20%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E5%9F%9F.html#本地方法栈" class="toc-sidebar-link">本地方法栈</a></li><li class="toc-sidebar-sub-header"><a href="/posts/java/jvm/1.%20%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E5%9F%9F.html#堆" class="toc-sidebar-link">堆</a></li><li class="toc-sidebar-sub-header"><a href="/posts/java/jvm/1.%20%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E5%9F%9F.html#方法区" class="toc-sidebar-link">方法区</a></li><li class="toc-sidebar-sub-header"><a href="/posts/java/jvm/1.%20%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E5%9F%9F.html#运行时常量池" class="toc-sidebar-link">运行时常量池</a></li><li class="toc-sidebar-sub-header"><a href="/posts/java/jvm/1.%20%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E5%9F%9F.html#直接内存" class="toc-sidebar-link">直接内存</a></li></ul></li></ul></div></div></div></div></div> <div class="option-box"><img src="/images/system/mobi.png" width="25px" class="nozoom"> <span class="show-txt">手机看</span> <div class="toc-container"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="text-align:center"><span style="font-size:0.9rem">微信扫一扫</span> <img height="180px" src="https://api.qrserver.com/v1/create-qr-code/?data=https://tama.wiki/posts/java/jvm/1.%20%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E5%9F%9F.html" style="margin:10px;">
                可以<b>手机看</b>或分享至<b>朋友圈</b></div></div></div></div> <div class="option-box"><img src="/images/system/toggle.png" width="25px" class="nozoom"> <span class="show-txt">左栏</span></div> <div class="option-box"><img src="/images/system/talk.png" width="25px" class="nozoom"> <span class="show-txt">交流群</span> <div class="toc-container"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="text-align:center"><span style="font-size:0.8rem;font-weight:bold;">添加我的微信进群交流</span> <img src="/images/personal/wechat_qrcode.png" height="180px" style="margin:10px;">
                PS：添加时请备注<b>加群</b>，谢谢！
              </div></div></div></div> <div class="option-box"><img src="/images/system/guli.png" width="25px" class="nozoom"> <span class="show-txt">支持我</span> <div class="toc-container"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="text-align:center"><span style="font-size:0.8rem;font-weight:bold;">鼓励/支持/赞赏我</span> <img height="180px" src="/images/personal/guli.png" style="margin:5px;"> <br>鼓励鼓励
              </div></div></div></div> <!----> <div title="2. 对象的创建与访问" class="option-box" style="padding-left:2px;text-align:center;"><a href="/posts/java/jvm/2. 对象的创建与访问.html"><img src="/images/system/right.png" width="30px" class="nozoom"> <span class="show-txt">下一篇</span></a></div></div>  <!----> </aside></div><div class="global-ui"><LockArticle></LockArticle></div></div>
    <script src="/assets/js/cg-styles.js?v=1635955335105" defer></script><script src="/assets/js/cg-4.js?v=1635955335105" defer></script><script src="/assets/js/cg-3.js?v=1635955335105" defer></script><script src="/assets/js/cg-26.js?v=1635955335105" defer></script><script src="/assets/js/cg-app.js?v=1635955335105" defer></script>
  </body>
</html>
